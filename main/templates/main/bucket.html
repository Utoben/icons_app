{% load static %}
<!DOCTYPE html>
<html lang="ru">
<head>
   <meta charset="UTF-8">
   <meta charset="utf-8" />
   <link rel="apple-touch-icon" sizes="76x76" href="{% static 'img//apple-icon.png' %}">
   <link rel="icon" type="image/png" href="{% static 'img//favicon.png' %}">
   <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />

   <title>Корзина</title>

   <meta content='width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0, shrink-to-fit=no' name='viewport' />
  <!--     Fonts and icons     -->
  <link href="https://fonts.googleapis.com/css?family=Montserrat:400,700,200" rel="stylesheet" />
  <link href="https://maxcdn.bootstrapcdn.com/font-awesome/latest/css/font-awesome.min.css" rel="stylesheet">
  <!-- CSS Files -->
  <link href="{% static 'css/bootstrap.min.css' %}" rel="stylesheet" />
  <link href="{% static 'css/paper-kit.css' %}" rel="stylesheet" />
</head>
<body class="landing-page sidebar-collapse">
    <nav class="navbar navbar-expand-lg fixed-top">
        <!-- <nav class="navbar navbar-expand-lg fixed-top navbar-transparent " color-on-scroll="300"> -->
        <div class="container">
            <div class="navbar-translate">
                <a class="navbar-brand" href="{% url 'home'%}" rel="tooltip" title="" data-placement="bottom" target="_blank">
                    Империя значков
                  </a>
                  <button class="navbar-toggler navbar-toggler" type="button" data-toggle="collapse" data-target="#navigation" aria-controls="navigation-index" aria-expanded="false" aria-label="Toggle navigation">
                    <span class="navbar-toggler-bar bar1"></span>
                    <span class="navbar-toggler-bar bar2"></span>
                    <span class="navbar-toggler-bar bar3"></span>
                  </button>
            </div>
            <div class="collapse navbar-collapse justify-content-end" id="navigation">
                <ul class="navbar-nav">
                    <li class="nav-item">
                      <!-- <a href="../index.html" class="nav-link"><i class="nc-icon nc-layout-11"></i> Components</a> -->
                      {% if request.user.is_authenticated and request.user.is_staff %}
                        <a href="/admin" class="nav-link" rel="tooltip" title="А вот сюда только админам" data-placement="bottom">Admin</a>
                      {% endif %}
                    </li>
                    <li class="nav-item">
                      <a href="{% url 'home'%}" class="nav-link" rel="tooltip" title="Вернемся на главную" data-placement="bottom">Главная</a>
                    </li>
                    <li class="nav-item">
                        <a href="{% url 'logout'%}" class="nav-link" rel="tooltip" title="Бегом в корзину" data-placement="bottom">Выйти</a>
                      </li>
                  </ul>
            </div>
        </div>
    </nav>
    <div class="section landing-section">
        <div class="container">
            <div class="row">
                <div class="col-md-10 ml-auto mr-auto">
                    <div class="card" id="images_container">
                        <div class="card-title">
                            <h2 class="text-center">Выбранные значки в количестве: {{ count }}</h2>
                        </div>
                        <div class="card-body">
                          <div class="row">
                             {% for icon in icons %}
                                 {% if icon.image %}
                                     <div class="col-lg-2 col-md-4 col-4 ml-auto mr-auto">
                                        <div class="card card-profile card-plain">
                                          <div class="card">
                                           <img src="{{icon.image}}" class="img-rounded img-responsive" width="150" alt="Image">
                                          </div>
                                        </div>
                                     </div>
                                 {% endif %}
                             {% endfor %}
                          </div>
                        </div>    
                        <div class="card-footer">
                            <form class="" method="post" id="clear_icons">
                                {% csrf_token %}
                                <button type="button" class="btn btn-fill btn-primary" onclick="clearBucket()">Очистить корзину</button>
                            </form>
                        </div>
                    </div>
                </div>
                <div class="col-md-10 ml-auto mr-auto">
                    <div class="card">
                        <div class="card-title">
                            <h2 class="text-center">Давайте заполним информацию о заказчике</h2>
                        </div>
                        <div class="card-body">
                            <form class="contact-form" method="post" id="customer_data" class="mt-4">
                                {% csrf_token %}
                                <div class="row">
                                    <div class="col-md-12">
                                        <label>Имя</label>
                                        <div class="input-group">
                                            <div class="input-group-prepend">
                                                <span class="input-group-text">
                                                  <i class="nc-icon nc-single-02"></i>
                                                </span>
                                            </div>
                                            <input type="text" class="form-control" name="fullname" placeholder="Иванов Иван Иванович">
                                        </div>
                                    </div>
                                    <div class="col-md-6">
                                        <label>Телефон</label>
                                        <div class="input-group">
                                            <div class="input-group-prepend">
                                                <span class="input-group-text">
                                                  <i class="nc-icon nc-mobile"></i>
                                                </span>
                                            </div>
                                            <input type="phone" class="form-control" name="phone" placeholder="+79995557766">
                                        </div>
                                    </div>
                                    <div class="col-md-6">
                                        <label>Email</label>
                                        <div class="input-group">
                                            <div class="input-group-prepend">
                                                <span class="input-group-text">
                                                  <i class="nc-icon nc-email-85"></i>
                                                </span>
                                            </div>
                                            <input type="email" class="form-control" name="email" placeholder="your_email@mail.com">
                                        </div>
                                    </div>
                                </div>
                                <div class="row">
                                    <!-- <div class="col-md-2 ml-auto mr-auto"> -->
                                    <div class="col-md-2">
                                        <button type="button" class="btn btn-lg btn-fill btn-primary" onclick="sendOrder()">Отправить</button>
                                    </div>
                                </div>
                            </form>
                        </div>
                    </div>   
                </div>
            </div>
            <div class="col-md-2 ml-auto mr-auto">
                <form class="form" method="get" id="update_profile_data" class="mt-4">
                    <button type="button" class="btn btn-outline-warning btn-round" onclick="getProfileInfo()">Подтянем информацию из профиля?</button>
                </form>
            </div>
        </div>
    </div>
    <!--   Core JS   -->
    <!--   Core JS Files   -->
    <script src="{% static 'js/core/jquery.min.js' %}" type="text/javascript"></script>
    <script src="{% static 'js/core/popper.min.js' %}" type="text/javascript"></script>
    <script src="{% static 'js/core/bootstrap.min.js' %}" type="text/javascript"></script>
    <!--  Plugin for Switches, full documentation here: http://www.jque.re/plugins/version3/bootstrap.switch/ -->
    <script src="{% static 'js/plugins/bootstrap-switch.js' %}"></script>
    <!--  Plugin for the Sliders, full documentation here: http://refreshless.com/nouislider/ -->
    <script src="{% static 'js/plugins/nouislider.min.js' %}" type="text/javascript"></script>
    <!--  Plugin for the DatePicker, full documentation here: https://github.com/uxsolutions/bootstrap-datepicker -->
    <script src="{% static 'js/plugins/moment.min.js' %}"></script>
    <script src="{% static 'js/plugins/bootstrap-datepicker.js' %}" type="text/javascript"></script>
    <!-- Control Center for Paper Kit: parallax effects, scripts for the example pages etc -->
    <script src="{% static 'js/paper-kit.js' %}" type="text/javascript"></script>
    <!--  Google Maps Plugin    -->
    <!-- <script type="text/javascript" src="https://maps.googleapis.com/maps/api/js?key=YOUR_KEY_HERE"></script> -->
    <script>
        function clearBucket(event) {
            //   event.preventDefault();
            var csrfToken = $('input[name="csrfmiddlewaretoken"]').val();
            var formData = new FormData($('#clear_icons')[0]);
            $.ajax({
                url: '/clear_bucket/',
                type: 'POST',
                data: formData,
                processData: false,
                contentType: false,
                beforeSend: function(xhr) {
                  xhr.setRequestHeader('X-CSRFToken', csrfToken);
                },
                success: function(response) {
                    location.reload();
                    console.log("success " + response.success)
                },
                error: function(xhr, status, error) {
                    console.log("No success", error)
                }
            });
        }

        function sendOrder(event) {
            //   event.preventDefault();
            var csrfToken = $('input[name="csrfmiddlewaretoken"]').val();
            var formData = new FormData($('#customer_data')[0]);
            $.ajax({
                url: '/send_order/',
                type: 'POST',
                data: formData,
                processData: false,
                contentType: false,
                beforeSend: function(xhr) {
                  xhr.setRequestHeader('X-CSRFToken', csrfToken);
                },
                success: function(response) {
                    location.reload();
                    console.log("success " + response.success)
                },
                error: function(xhr, status, error) {
                    console.log("No success", error)
                }
            });
        }

        // тянем инфо из профиля
        function getProfileInfo(event) {
            //   event.preventDefault();
            var csrfToken = $('input[name="csrfmiddlewaretoken"]').val();
            var formData = new FormData($('#update_profile_data')[0]);
            $.ajax({
                url: '/get_profile_info/',
                type: 'GET',
                data: formData,
                processData: false,
                contentType: false,
                beforeSend: function(xhr) {
                  xhr.setRequestHeader('X-CSRFToken', csrfToken);
                },
                success: function(response) {
                    // location.reload();
                    console.log("success " + response.success)
                    $('input[name="fullname"]').val(response.fullname);
                    $('input[name="phone"]').val(response.phone);
                    $('input[name="email"]').val(response.email);
                },
                error: function(xhr, status, error) {
                    console.log("No success", error)
                }
            });
        }
    </script>
</body>
</html>
